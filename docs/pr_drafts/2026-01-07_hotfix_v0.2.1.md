# Hotfix v0.2.1: Cross-Domain Auth Fix (Enhanced Security)

## Summary
Fixes login failures on Firefox and Mobile browsers caused by Third-Party Cookie blocking, using a secure one-time code exchange pattern.

## Problem
- Backend (`onrender.com`) was setting cookies, which Firefox/Safari/Mobile blocked as "Third-Party".
- Error: "classified as a bounce tracker"

## Solution: One-Time Code Exchange
This is more secure than passing JWT in URL:
1. **Backend** generates a one-time code (UUID), stores code→JWT mapping (1 min expiry)
2. **Backend** redirects to Frontend with code (NOT JWT) in URL
3. **Frontend** calls `POST /auth/exchange` with code to get JWT
4. **Frontend** sets First-Party HTTPOnly cookie with JWT

## Changes

### Backend (`auth.service.ts`)
- Added `codeStore` Map for code→JWT mapping
- Added `generateCode()` and `exchangeCode()` methods
- Codes expire after 1 minute and are single-use

### Backend (`auth.controller.ts`)
- `googleAuthRedirect`: Now redirects with `?code=` instead of `?token=`
- Added `POST /auth/exchange` endpoint

### Frontend (`api/auth/callback/route.ts`)
- Now receives `code`, calls backend `/auth/exchange` to get JWT
- Sets HTTPOnly cookie with returned JWT

## Security Benefits
- ✅ JWT never appears in URL (not in browser history/logs)
- ✅ Code is single-use (prevents replay attacks)
- ✅ Code expires in 1 minute
- ✅ Cookie is First-Party (accepted by all browsers)

## Testing
- [ ] Chrome Desktop
- [ ] Firefox (Strict Tracking Protection)
- [ ] Mobile Chrome/Safari
